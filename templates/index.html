<!DOCTYPE html>
<html lang="en">
<script src="https://d3js.org/d3.v7.min.js"></script>
<!--jquery to help with listbox -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Load icon library not sure if this works-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script src="{{ url_for('static', filename='stock_vis.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<head>
    <meta charset="UTF-8">
    <title>Stocks - Add stock item into stock viewer.</title>
    <!--reference for adding items to listbox:https://www.includehelp.com/code-snippets/javascript-add-user-entered-item-into-listbox.aspx-->
    <script type="text/javascript">
        function insertStockIntoViewer() {
            var x = document.getElementById("stock-list");
            var item = document.getElementById("name").value;
            var option = document.createElement("option");
            option.text = item;
            option.value = item;
            x.add(option);
            //alert(item + " has been added.");
            document.getElementById('name').value = ''
        }
    </script>
</head>

<!--style for the path that's being drawn in the viz-->
<style>
    path.line {
        fill: none;
        stroke: blue;
        stroke-width: 3px;
    }
</style>


<body style="text-align: left;">

<h1>Stocks - Add stock into StockViewer.</h1>
<p><big>Enter your stock: </big></p>


<form id="stock-search" class="stock-search">
<p><input type="text" placeholder="stock ticker.." id="name"/>
  <input type="button" onclick="insertStockIntoViewer()" value="Insert into Stock Viewer"></p>

	<!--<label for ="first_money">Money to invest:</label><br>
		<input type ="text" id="first_money" name="first_money"><br>-->
	<!--<input class="new-search" type="submit" value="Submit">-->
  <!--<select id="stock-list" multiple="multiple" size="20" style="width:200px;">
      <option></option>
  </select>-->

  <!--reference for limiting selected options:https://stackoverflow.com/questions/30474614/multiple-select-limit-number-of-selection/30475067.-->
      <script type="text/javascript">
          $(document).ready(function() {
            var last_valid_selection = null;
            $('#stock-list').change(function(event) {
              if ($(this).val().length > 2) {
                $(this).val(last_valid_selection);
              } else {
                last_valid_selection = $(this).val();
              }
            });
          });
          </script>

</form>

<form id="stock-select">
<select id="stock-list" name="name" multiple="multiple" size="20" style="width:200px;">
</select>
</form>
<span id="result" ></span>
<div id="stock_vis" ></div>

<script>
    function stockSubmit(ev) {
      ev.preventDefault();
      var request = new XMLHttpRequest();
      request.addEventListener('load', stockShow);
      request.open('POST', "{{ url_for('return_stock_info')}}");
      request.send(new FormData(this));
    }

    function stockShow() {
      console.log(this.responseText);
      //data in json 
      let data = JSON.parse(this.responseText);
      console.log(data);

      //idea for how to code stock visualization
      var vis = new StockVis("stock_vis",data);
      vis.render();
    }

    var form = document.getElementById('stock-select');

    form.addEventListener('change', stockSubmit);
    //console.log(form)
</script>
</body>
</html>
